import org.gradle.api.Project;
import org.gradle.api.initialization.Settings;

apply plugin: 'project-report'


allprojects {
    apply plugin: 'java'
    apply plugin: 'groovy'
    apply from: "${rootProject.projectDir}/tool/checkstyle/config/checkstyle.gradle"
	apply from: "${rootProject.projectDir}/libraries.gradle"

    repositories {
        mavenCentral()
        maven { url "http://repo.springsource.org/libs-release" }
		flatDir name: 'localRepository', dirs: "${rootProject.rootDir}/lib"
    }

    dependencies {
        compile libraries.'groovy-all-indy'
        compile libraries.'insight-annotation'
        compile libraries.'slf4j-api'

        testCompile libraries.'fest-assert'
        testCompile libraries.'mockito-all'
        testCompile libraries.'mockito-groovy-support'
        testCompile libraries.'testng'
       
        runtime libraries.'logback'
        
        /* invoke dynamic config */
        def enableIndy = System.properties.enableIndy?.toBoolean() ?: false
        sourceCompatibility = 1.7
        targetCompatibility = 1.7
        [compileGroovy.groovyOptions,compileTestGroovy.groovyOptions]*.with {
            fork = true
            optimizationOptions = [indy: enableIndy, 'int': true]
            encoding = 'UTF-8'
        }

        tasks.compileJava.dependsOn(['clean'])
        tasks.jar.dependsOn(['checkstyleReport'])
    }
}